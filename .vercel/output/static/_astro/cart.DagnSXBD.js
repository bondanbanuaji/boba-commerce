import{a as N,e as d}from"./index.CASokwIO.js";const C=5,R=6,O=10;let D=(t,e,r,n)=>(t.events=t.events||{},t.events[r+O]||(t.events[r+O]=n(a=>{t.events[r].reduceRight((s,u)=>(u(s),s),{shared:{},...a})})),t.events[r]=t.events[r]||[],t.events[r].push(e),()=>{let a=t.events[r],s=a.indexOf(e);a.splice(s,1),a.length||(delete t.events[r],t.events[r+O](),delete t.events[r+O])}),L=1e3,b=(t,e)=>D(t,n=>{let a=e(n);a&&t.events[R].push(a)},C,n=>{let a=t.listen;t.listen=(...u)=>(!t.lc&&!t.active&&(t.active=!0,n()),a(...u));let s=t.off;return t.events[R]=[],t.off=()=>{s(),setTimeout(()=>{if(t.active&&!t.lc){t.active=!1;for(let u of t.events[R])u();t.events[R]=[]}},L)},()=>{t.listen=a,t.off=s}}),P=(t,e,r)=>{Array.isArray(t)||(t=[t]);let n,a,s=()=>{if(a===d)return;a=d;let l=t.map(i=>i.get());if(!n||l.some((i,A)=>i!==n[A])){n=l;let i=e(...l);i&&i.then&&i.t?i.then(A=>{n===l&&u.set(A)}):(u.set(i),a=d)}},u=N(void 0),o=u.get;u.get=()=>(s(),o());let f=s;return b(u,()=>{let l=t.map(i=>i.listen(f));return s(),()=>{for(let i of l)i()}}),u};const S=(t,e)=>P(t,e),v=(t={})=>{let e=N(t);return e.setKey=function(r,n){let a=e.value;typeof n>"u"&&r in e.value?(e.value={...e.value},delete e.value[r],e.notify(a,r)):e.value[r]!==n&&(e.value={...e.value,[r]:n},e.notify(a,r))},e},F={};function M(t){const e=Q(t),r=new ArrayBuffer(e.length),n=new DataView(r);for(let a=0;a<r.byteLength;a++)n.setUint8(a,e.charCodeAt(a));return r}const B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function Q(t){t.length%4===0&&(t=t.replace(/==?$/,""));let e="",r=0,n=0;for(let a=0;a<t.length;a++)r<<=6,r|=B.indexOf(t[a]),n+=6,n===24&&(e+=String.fromCharCode((r&16711680)>>16),e+=String.fromCharCode((r&65280)>>8),e+=String.fromCharCode(r&255),r=n=0);return n===12?(r>>=4,e+=String.fromCharCode(r)):n===18&&(r>>=2,e+=String.fromCharCode((r&65280)>>8),e+=String.fromCharCode(r&255)),e}const k=-1,G=-2,V=-3,Y=-4,H=-5,J=-6;function j(t,e){return W(JSON.parse(t),e)}function W(t,e){if(typeof t=="number")return a(t,!0);if(!Array.isArray(t)||t.length===0)throw new Error("Invalid input");const r=t,n=Array(r.length);function a(s,u=!1){if(s===k)return;if(s===V)return NaN;if(s===Y)return 1/0;if(s===H)return-1/0;if(s===J)return-0;if(u||typeof s!="number")throw new Error("Invalid input");if(s in n)return n[s];const o=r[s];if(!o||typeof o!="object")n[s]=o;else if(Array.isArray(o))if(typeof o[0]=="string"){const f=o[0],l=e&&Object.hasOwn(e,f)?e[f]:void 0;if(l){let i=o[1];return typeof i!="number"&&(i=r.push(o[1])-1),n[s]=l(a(i))}switch(f){case"Date":n[s]=new Date(o[1]);break;case"Set":const i=new Set;n[s]=i;for(let c=1;c<o.length;c+=1)i.add(a(o[c]));break;case"Map":const A=new Map;n[s]=A;for(let c=1;c<o.length;c+=2)A.set(a(o[c]),a(o[c+1]));break;case"RegExp":n[s]=new RegExp(o[1],o[2]);break;case"Object":n[s]=Object(o[1]);break;case"BigInt":n[s]=BigInt(o[1]);break;case"null":const I=Object.create(null);n[s]=I;for(let c=1;c<o.length;c+=2)I[o[c]]=a(o[c+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const c=globalThis[f],p=new c(a(o[1]));n[s]=o[2]!==void 0?p.subarray(o[2],o[3]):p;break}case"ArrayBuffer":{const c=o[1],p=M(c);n[s]=p;break}case"Temporal.Duration":case"Temporal.Instant":case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.PlainMonthDay":case"Temporal.PlainYearMonth":case"Temporal.ZonedDateTime":{const c=f.slice(9);n[s]=Temporal[c].from(o[1]);break}case"URL":{const c=new URL(o[1]);n[s]=c;break}case"URLSearchParams":{const c=new URLSearchParams(o[1]);n[s]=c;break}default:throw new Error(`Unknown type ${f}`)}}else{const f=new Array(o.length);n[s]=f;for(let l=0;l<o.length;l+=1){const i=o[l];i!==G&&(f[l]=a(i))}}else{const f={};n[s]=f;for(const l in o){if(l==="__proto__")throw new Error("Cannot parse an object with a `__proto__` property");const i=o[l];f[l]=a(i)}}return n[s]}return a(0)}function q(t){return t.endsWith("/")?t:t+"/"}const m={actionName:"_action"},Z=m,z=q,g={BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,CONTENT_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,MISDIRECTED_REQUEST:421,UNPROCESSABLE_CONTENT:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NETWORK_AUTHENTICATION_REQUIRED:511},X=Object.entries(g).reduce((t,[e,r])=>({...t,[r]:e}),{});class T extends Error{type="AstroActionError";code="INTERNAL_SERVER_ERROR";status=500;constructor(e){super(e.message),this.code=e.code,this.status=T.codeToStatus(e.code),e.stack&&(this.stack=e.stack)}static codeToStatus(e){return g[e]}static statusToCode(e){return X[e]??"INTERNAL_SERVER_ERROR"}static fromJson(e){return K(e)?new x(e.issues):$(e)?new T(e):new T({code:"INTERNAL_SERVER_ERROR"})}}function $(t){return typeof t=="object"&&t!=null&&"type"in t&&t.type==="AstroActionError"}function K(t){return typeof t=="object"&&t!=null&&"type"in t&&t.type==="AstroActionInputError"&&"issues"in t&&Array.isArray(t.issues)}class x extends T{type="AstroActionInputError";issues;fields;constructor(e){super({message:`Failed to validate: ${JSON.stringify(e,null,2)}`,code:"BAD_REQUEST"}),this.issues=e,this.fields={};for(const r of e)if(r.path.length>0){const n=r.path[0].toString();this.fields[n]??=[],this.fields[n]?.push(r.message)}}}function U(t){return`?${new URLSearchParams({[m.actionName]:t}).toString()}`}function y(t){if(t.type==="error"){let e;try{e=JSON.parse(t.body)}catch{return{data:void 0,error:new T({message:t.body,code:"INTERNAL_SERVER_ERROR"})}}return{error:T.fromJson(e),data:void 0}}return t.type==="empty"?{data:void 0,error:void 0}:{data:j(t.body,{URL:e=>new URL(e)}),error:void 0}}const tt="%2E";function w(t={},e=""){return new Proxy(t,{get(r,n){if(r.hasOwnProperty(n)||typeof n=="symbol")return r[n];const a=e+encodeURIComponent(n.toString()).replaceAll(".",tt);function s(u){return _(u,a)}return Object.assign(s,{queryString:U(a),toString:()=>s.queryString,bind:s.bind,valueOf:()=>s.valueOf,$$FORM_ACTION:function(){return{method:"POST",name:"_astroAction",action:"?"+new URLSearchParams(s.toString()).toString()}},async orThrow(u){const{data:o,error:f}=await _(u,a);if(f)throw f;return o}}),w(s,a+".")}})}function et(t){let e=`${"/".replace(/\/$/,"")}/_actions/${new URLSearchParams(t()).get(Z.actionName)}`;return e=z(e),e}async function _(t,e,r){const n=new Headers;n.set("Accept","application/json");for(const[o,f]of Object.entries(F))n.set(o,f);let a=t;if(!(a instanceof FormData)){try{a=JSON.stringify(t)}catch(o){throw new T({code:"BAD_REQUEST",message:`Failed to serialize request body to JSON. Full error: ${o.message}`})}a?n.set("Content-Type","application/json"):n.set("Content-Length","0")}const s=await fetch(et(()=>U(e)),{method:"POST",body:a,headers:n});if(s.status===204)return y({type:"empty",status:204});const u=await s.text();return s.ok?y({type:"data",body:u,status:200,contentType:"application/json+devalue"}):y({type:"error",body:u,status:s.status,contentType:"application/json"})}const nt=w(),st=N(!1),E=v({}),ot=S(E,t=>Object.values(t).reduce((e,r)=>e+r.quantity,0)),it=S(E,t=>Object.values(t).reduce((e,r)=>e+r.price*r.quantity,0));async function ct(t,e=1){const r=E.get(),n=t.variants?.[0]?.id||t.id,a=r[n];a?E.setKey(n,{...a,quantity:a.quantity+e}):E.setKey(n,{productId:t.id,variantId:n,name:t.name,price:t.price+(t.variants?.[0]?.priceOffset||0),image:t.image,quantity:e}),h();try{await nt.addToCart({productId:t.id,variantId:n,quantity:e})}catch(s){console.error("Failed to sync cart with backend:",s)}}function rt(t){const e={...E.get()};delete e[t],E.set(e),h()}function ut(t,e){if(e<=0){rt(t);return}const r=E.get()[t];r&&(E.setKey(t,{...r,quantity:e}),h())}function h(){typeof window<"u"&&localStorage.setItem("boba-cart",JSON.stringify(E.get()))}function ft(){if(typeof window<"u"){const t=localStorage.getItem("boba-cart");if(t)try{E.set(JSON.parse(t))}catch(e){console.error("Failed to hydrate cart:",e)}}}export{st as $,ot as a,E as b,it as c,ct as d,ft as h,rt as r,ut as u};
